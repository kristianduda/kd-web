!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.kd=e():t.kd=e()}(self,(function(){return(()=>{"use strict";var t={431:(t,e,r)=>{r.r(e),r.d(e,{auth:()=>_,getConfig:()=>C,init:()=>I,storage:()=>a,store:()=>B});var a={};r.r(a),r.d(a,{getUser:()=>i,removeUser:()=>n,setUser:()=>o});const s="kd-user",i=()=>(s,JSON.parse(sessionStorage.getItem("kd-user"))),o=t=>{var e;e=t,sessionStorage.setItem("kd-user",JSON.stringify(e))},n=()=>{sessionStorage.removeItem("kd-user")},u=[],c={limit:1e3,skip:0},f={field:"_id",dir:"asc"},w=[],h=()=>{var t=i();return{Accept:"application/json","Content-Type":"application/json",Authorization:t?`Bearer  ${t.token}`:null}},d=async t=>{const e=`${t.url.auth}/api/User/refresh`,r=i(),a=r?r.refreshToken:t.key,s=await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(200===s.status){const t=await s.json();return t.refreshToken=a,o(t),!0}return n(),!1},l=async(t,e)=>{const r=`${t.url.store}/api/file`,a=new FormData;a.append("file",e);const s=await fetch(r,{method:"POST",headers:{Authorization:"Bearer "+i().token},body:a});if(200===s.status)return await s.json();if(401===s.status&&await d(t))return await l(t,e);throw new Error(s.statusText)},p=async(t,e)=>{const r=`${t.url.store}/api/file/${e}`,a=await fetch(r,{method:"GET",headers:{Authorization:"Bearer "+i().token}});if(200===a.status)return await a.blob();if(401===a.status&&await d(t))return await p(t,e);throw new Error(a.statusText)},y=async(t,e)=>{const r=`${t.url.store}/api/file/${e}`,a=await fetch(r,{method:"DELETE",headers:{Authorization:"Bearer "+i().token}});if(200===a.status);else{if(401!==a.status||!await d(t))throw new Error(a.statusText);await y(t,e)}},g=async(t,e,r)=>{const a=`${t.url.store}/api/store/${e}/${r}`,s=await fetch(a,{headers:h()});if(200===s.status)return await s.json();if(404===s.status)return null;if(401===s.status&&await d(t))return await g(t,e,r);throw new Error(s.statusText)},T=async(t,e,r=u,a=f,s=c,i=w)=>{const o=`${t.url.store}/api/store/${e}?filters=${JSON.stringify(r)}&page=${JSON.stringify(s)}&sort=${JSON.stringify(a)}&fields=${JSON.stringify(i)}`,n=await fetch(o,{headers:h()});if(200===n.status){const t=await n.json();return t.filters=r,t.sort=a,t.page=s,t.fields=i,t}if(401===n.status&&await d(t))return await T(t,e,r,a,s,i);throw new Error(n.statusText)},$=async(t,e,r,a)=>{const s=`${t.url.store}/api/store/${e}/${a}`,i=await fetch(s,{method:"PUT",headers:h(),body:JSON.stringify(r)});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await $(t,e,r,a);throw new Error(i.statusText)},O=async(t,e,r)=>{const a=`${t.url.store}/api/store/${e}`,s=await fetch(a,{method:"POST",headers:h(),body:JSON.stringify(r)});if(200===s.status)return await s.json();if(401===s.status&&await d(t))return await O(t,e,r);throw new Error(s.statusText)},S=async(t,e,r)=>{const a=`${t.url.store}/api/store/${e}/${r}`,s=await fetch(a,{method:"DELETE",headers:h()});if(200===s.status);else{if(401!==s.status||!await d(t))throw new Error(s.statusText);await S(t,e,r)}},E=async(t,e,r)=>{const a=`${t.url.store}/api/store/${e}?filters=${JSON.stringify(r)}`,s=await fetch(a,{method:"DELETE",headers:h()});if(200!==s.status){if(401===s.status&&await d(t))return await E(t,e,r);throw new Error(s.statusText)}},m=async(t,e,r,a=u,s=f,i=c)=>{const o=`${t.url.store}/api/store/${e}/aggregation?group=${JSON.stringify(r)}&filters=${JSON.stringify(a)}&sort=${JSON.stringify(s)}&page=${JSON.stringify(i)}`,n=await fetch(o,{headers:h()});if(200===n.status)return await n.json();if(401===n.status&&await d(t))return await m(t,e,r,a,s);throw new Error(n.statusText)},j=async(t,e,r,a)=>{const s=`${t.url.auth}/api/user/oauth`,i=await fetch(s,{method:"PUT",headers:h(),body:JSON.stringify({provider:e,code:r,redirect_uri:a})});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await j(t,e,r,a);throw new Error(i.statusText)},b=async t=>{const e=`${t.url.auth}/api/user/secret`,r=await fetch(e,{method:"POST",headers:h()});if(200===r.status)return await r.json();if(401===r.status&&await d(t))return await b(t);throw new Error(r.statusText)},N=async(t,e)=>{const r=`${t.url.auth}/api/user/sign?withQrCode=true`,a=await fetch(r,{method:"POST",headers:h(),body:JSON.stringify({data:e})});if(200===a.status)return await a.json();if(401===a.status&&await d(t))return await N(t,e);throw new Error(a.statusText)},x=async(t,e,r)=>{const a=`${t.url.auth}/api/user/verify`,s=await fetch(a,{method:"POST",headers:h(),body:JSON.stringify({data:e,signature:r})});if(200===s.status)return!0;if(400===s.status)return!1;if(401===s.status&&await d(t))return await x(t,e,r);throw new Error(s.statusText)},k=async(t,e)=>{const r=`${t.url.auth}/api/user?filters=${JSON.stringify(e)}&sort=${JSON.stringify({field:"name",dir:"asc"})}`,a=await fetch(r,{headers:h()});if(200===a.status)return await a.json();if(401===a.status&&await d(t))return await k(t,e);throw new Error(a.statusText)},J={},P=async(t,e)=>{const r=`${t.url.auth}/api/user/${e}`,a=await fetch(r,{headers:h()});if(200===a.status)return await a.json();if(404===a.status)return null;if(401===a.status&&await d(t))return await P(t,e);throw new Error(a.statusText)},v=async(t,e,r)=>{const a=`${t.url.auth}/api/user/${e}`,s=await fetch(a,{method:"PUT",headers:h(),body:JSON.stringify(r)});if(200===s.status){const t=await s.json(),e=i();return o({...t,token:e.token,refreshToken:e.refreshToken}),t}if(401===s.status&&await d(t))return await v(t,e,r);throw new Error(s.statusText)},U={url:{store:"https://stored.azurewebsites.net",auth:"https://storeauth.azurewebsites.net"},key:null};let A=U;const I=t=>{A={...U,...t}},C=()=>A,B={postFile:t=>l(A,t),getFile:t=>p(A,t),delFile:t=>y(A,t),getById:(t,e)=>g(A,t,e),get:(t,e,r,a,s)=>T(A,t,e,r,a,s),put:(t,e,r)=>$(A,t,e,r),post:(t,e)=>O(A,t,e),delById:(t,e)=>S(A,t,e),del:(t,e)=>E(A,t,e),aggregation:(t,e,r,a,s)=>m(A,t,e,r,a,s),getLocation:()=>new Promise(((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const r={type:"Point",coordinates:[e.coords.latitude,e.coords.longitude]};t(r)}),(t=>{let r;switch(t.code){case t.PERMISSION_DENIED:r="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:r="Location information is unavailable.";break;case t.TIMEOUT:r="The request to get user location timed out.";break;case t.UNKNOWN_ERROR:default:r="An unknown error occurred."}e(new Error(r))})):e("Geolocation is not supported by this browser.")}))},_={auth:(t,e,r)=>(async(t,e,r,a="")=>{const s=`${t.url.auth}/api/user/auth`,i=await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:r,token:a})});if(200===i.status){const t=await i.json();return o(t),t}if(401===i.status)return null;throw new Error(i.statusText)})(A,t,e,r),oAuth:(t,e,r,a)=>(async(t,e,r,a,s=null)=>{const i=`${t.url.auth}/api/user/oauth`,n=await fetch(i,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({provider:e,code:r,redirect_uri:a,config:s})});if(200===n.status){const t=await n.json();return o(t),t}if(401===n.status)return null;throw new Error(n.statusText)})(A,t,e,r,a),reset:(t,e)=>(async(t,e,r)=>{const a=`${t.url.auth}/api/user/reset`,s=await fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,redirectUri:r})});if(200!==s.status)throw new Error(s.statusText)})(A,t,e),updateOauth:(t,e,r)=>j(A,t,e,r),generateSecret:()=>b(A),sign:t=>N(A,t),verify:(t,e)=>x(A,t,e),getUsers:t=>k(A,t),getUserCached:t=>(async(t,e)=>{try{return J[e]||(J[e]=await P(t,e)),J[e]}catch(t){throw t}})(A,t),getUser:t=>P(A,t),updateUser:(t,e)=>v(A,t,e)}}},e={};function r(a){if(e[a])return e[a].exports;var s=e[a]={exports:{}};return t[a](s,s.exports,r),s.exports}return r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(431)})()}));