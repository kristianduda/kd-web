!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.kd=e():t.kd=e()}(self,(function(){return(()=>{"use strict";var t={368:(t,e,a)=>{a.r(e),a.d(e,{ajax:()=>q,auth:()=>G,getConfig:()=>M,init:()=>F,storage:()=>r,store:()=>R});var r={};a.r(r),a.d(r,{getUser:()=>i,removeUser:()=>n,setUser:()=>o});const s="kd-user",i=()=>(s,JSON.parse(sessionStorage.getItem("kd-user"))),o=t=>{var e;e=t,sessionStorage.setItem("kd-user",JSON.stringify(e))},n=()=>{sessionStorage.removeItem("kd-user")},u=[],w={limit:1e3,skip:0},f={field:"_id",dir:"asc"},c=[],h=()=>{var t=i();return{Accept:"application/json","Content-Type":"application/json",Authorization:t?`Bearer  ${t.token}`:null}},d=async t=>{const e=`${t.url.auth}/api/User/refresh`,a=i(),r=a?a.refreshToken:t.key,s=await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(200===s.status){const t=await s.json();return t.refreshToken=r,o(t),!0}return n(),!1},l=async(t,e)=>{const a=`${t.url.store}/api/file`,r=new FormData;r.append("file",e);const s=await fetch(a,{method:"POST",headers:{Authorization:"Bearer "+i().token},body:r});if(200===s.status)return await s.json();if(401===s.status&&await d(t))return await l(t,e);throw new Error(s.statusText)},y=async(t,e)=>{const a=`${t.url.store}/api/file/${e}`,r=await fetch(a,{method:"GET",headers:{Authorization:"Bearer "+i().token}});if(200===r.status)return await r.blob();if(401===r.status&&await d(t))return await y(t,e);throw new Error(r.statusText)},p=async(t,e)=>{const a=`${t.url.store}/api/file/${e}`,r=await fetch(a,{method:"DELETE",headers:{Authorization:"Bearer "+i().token}});if(200===r.status);else{if(401!==r.status||!await d(t))throw new Error(r.statusText);await p(t,e)}},g=async(t,e,a)=>{const r=`${t.url.store}/api/store/${e}/${a}`,s=await fetch(r,{headers:h()});if(200===s.status)return await s.json();if(404===s.status)return null;if(401===s.status&&await d(t))return await g(t,e,a);throw new Error(s.statusText)},T=async(t,e,a=u,r=f,s=w,i=c)=>{const o=`${t.url.store}/api/store/${e}?filters=${JSON.stringify(a)}&page=${JSON.stringify(s)}&sort=${JSON.stringify(r)}&fields=${JSON.stringify(i)}`,n=await fetch(o,{headers:h()});if(200===n.status){const t=await n.json();return t.filters=a,t.sort=r,t.page=s,t.fields=i,t}if(401===n.status&&await d(t))return await T(t,e,a,r,s,i);throw new Error(n.statusText)},$=async(t,e,a,r)=>{const s=`${t.url.store}/api/store/${e}/${r}`,i=await fetch(s,{method:"PUT",headers:h(),body:JSON.stringify(a)});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await $(t,e,a,r);throw new Error(i.statusText)},O=async(t,e,a)=>{const r=`${t.url.store}/api/store/${e}`,s=await fetch(r,{method:"POST",headers:h(),body:JSON.stringify(a)});if(200===s.status)return await s.json();if(401===s.status&&await d(t))return await O(t,e,a);throw new Error(s.statusText)},S=async(t,e,a)=>{const r=`${t.url.store}/api/store/${e}/${a}`,s=await fetch(r,{method:"DELETE",headers:h()});if(200===s.status);else{if(401!==s.status||!await d(t))throw new Error(s.statusText);await S(t,e,a)}},E=async(t,e,a)=>{const r=`${t.url.store}/api/store/${e}?filters=${JSON.stringify(a)}`,s=await fetch(r,{method:"DELETE",headers:h()});if(200!==s.status){if(401===s.status&&await d(t))return await E(t,e,a);throw new Error(s.statusText)}},m=async(t,e,a,r=u,s=f,i=w)=>{const o=`${t.url.store}/api/store/${e}/aggregation?group=${JSON.stringify(a)}&filters=${JSON.stringify(r)}&sort=${JSON.stringify(s)}&page=${JSON.stringify(i)}`,n=await fetch(o,{headers:h()});if(200===n.status)return await n.json();if(401===n.status&&await d(t))return await m(t,e,a,r,s);throw new Error(n.statusText)},j=async(t,e,a,r)=>{const s=`${t.url.auth}/api/user`,i=await fetch(s,{method:"POST",headers:h(),body:JSON.stringify({username:e,password:a,name:r})});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await j(t,e,a,r);throw new Error(i.statusText)},N=async(t,e,a,r)=>{const s=`${t.url.auth}/api/user/oauth`,i=await fetch(s,{method:"PUT",headers:h(),body:JSON.stringify({provider:e,code:a,redirect_uri:r})});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await N(t,e,a,r);throw new Error(i.statusText)},x=async t=>{const e=`${t.url.auth}/api/user/secret`,a=await fetch(e,{method:"POST",headers:h()});if(200===a.status)return await a.json();if(401===a.status&&await d(t))return await x(t);throw new Error(a.statusText)},b=async(t,e)=>{const a=`${t.url.auth}/api/user/sign?withQrCode=true`,r=await fetch(a,{method:"POST",headers:h(),body:JSON.stringify({data:e})});if(200===r.status)return await r.json();if(401===r.status&&await d(t))return await b(t,e);throw new Error(r.statusText)},J=async(t,e,a)=>{const r=`${t.url.auth}/api/user/verify`,s=await fetch(r,{method:"POST",headers:h(),body:JSON.stringify({data:e,signature:a})});if(200===s.status)return!0;if(400===s.status)return!1;if(401===s.status&&await d(t))return await J(t,e,a);throw new Error(s.statusText)},k=async(t,e)=>{const a=`${t.url.auth}/api/user?filters=${JSON.stringify(e)}&sort=${JSON.stringify({field:"name",dir:"asc"})}`,r=await fetch(a,{headers:h()});if(200===r.status)return await r.json();if(401===r.status&&await d(t))return await k(t,e);throw new Error(r.statusText)},P={},v=async(t,e)=>{const a=`${t.url.auth}/api/user/${e}`,r=await fetch(a,{headers:h()});if(200===r.status)return await r.json();if(404===r.status)return null;if(401===r.status&&await d(t))return await v(t,e);throw new Error(r.statusText)},U=async(t,e,a)=>{const r=`${t.url.auth}/api/user/${e}`,s=await fetch(r,{method:"PUT",headers:h(),body:JSON.stringify(a)});if(200===s.status){const t=await s.json(),e=i();return o({...t,token:e.token,refreshToken:e.refreshToken}),t}if(401===s.status&&await d(t))return await U(t,e,a);throw new Error(s.statusText)},A=async(t,e,a)=>{const r=`${e}/${a}`,s=await fetch(r,{headers:h()});if(200===s.status)return await s.json();if(404===s.status)return null;if(401===s.status&&await d(t))return await A(t,e,a);throw new Error(s.statusText)},I=async(t,e,a=u,r=f,s=w,i=c)=>{const o=`${e}?filters=${JSON.stringify(a)}&page=${JSON.stringify(s)}&sort=${JSON.stringify(r)}&fields=${JSON.stringify(i)}`,n=await fetch(o,{headers:h()});if(200===n.status){const t=await n.json();return t.filters=a,t.sort=r,t.page=s,t.fields=i,t}if(401===n.status&&await d(t))return await I(t,e,a,r,s,i);throw new Error(n.statusText)},B=async(t,e,a,r)=>{const s=`${e}/${r}`,i=await fetch(s,{method:"PUT",headers:h(),body:JSON.stringify(a)});if(200===i.status)return await i.json();if(401===i.status&&await d(t))return await B(t,e,a,r);throw new Error(i.statusText)},C=async(t,e,a)=>{const r=`${e}`,s=await fetch(r,{method:"POST",headers:h(),body:JSON.stringify(a)});if(200===s.status)return await s.json();if(401===s.status&&await d(t))return await C(t,e,a);throw new Error(s.statusText)},L=async(t,e,a)=>{const r=`${e}/${a}`,s=await fetch(r,{method:"DELETE",headers:h()});if(200===s.status);else{if(401!==s.status||!await d(t))throw new Error(s.statusText);await L(t,e,a)}},D=async(t,e,a)=>{const r=`${e}?filters=${JSON.stringify(a)}`,s=await fetch(r,{method:"DELETE",headers:h()});if(200!==s.status){if(401===s.status&&await d(t))return await D(t,e,a);throw new Error(s.statusText)}},_={url:{store:"https://stored.azurewebsites.net",auth:"https://storeauth.azurewebsites.net"},key:null};let z=_;const F=t=>{z={..._,...t}},M=()=>z,R={postFile:t=>l(z,t),getFile:t=>y(z,t),delFile:t=>p(z,t),getById:(t,e)=>g(z,t,e),get:(t,e,a,r,s)=>T(z,t,e,a,r,s),put:(t,e,a)=>$(z,t,e,a),post:(t,e)=>O(z,t,e),delById:(t,e)=>S(z,t,e),del:(t,e)=>E(z,t,e),aggregation:(t,e,a,r,s)=>m(z,t,e,a,r,s),getLocation:()=>new Promise(((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const a={type:"Point",coordinates:[e.coords.latitude,e.coords.longitude]};t(a)}),(t=>{let a;switch(t.code){case t.PERMISSION_DENIED:a="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:a="Location information is unavailable.";break;case t.TIMEOUT:a="The request to get user location timed out.";break;case t.UNKNOWN_ERROR:default:a="An unknown error occurred."}e(new Error(a))})):e("Geolocation is not supported by this browser.")}))},G={auth:(t,e,a)=>(async(t,e,a,r="")=>{const s=`${t.url.auth}/api/user/auth`,i=await fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,password:a,token:r})});if(200===i.status){const t=await i.json();return o(t),t}if(401===i.status)return null;throw new Error(i.statusText)})(z,t,e,a),oAuth:(t,e,a,r)=>(async(t,e,a,r,s=null)=>{const i=`${t.url.auth}/api/user/oauth`,n=await fetch(i,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({provider:e,code:a,redirect_uri:r,config:s})});if(200===n.status){const t=await n.json();return o(t),t}if(401===n.status)return null;throw new Error(n.statusText)})(z,t,e,a,r),reset:(t,e)=>(async(t,e,a)=>{const r=`${t.url.auth}/api/user/reset`,s=await fetch(r,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({username:e,redirectUri:a})});if(200!==s.status)throw new Error(s.statusText)})(z,t,e),updateOauth:(t,e,a)=>N(z,t,e,a),generateSecret:()=>x(z),sign:t=>b(z,t),verify:(t,e)=>J(z,t,e),getUsers:t=>k(z,t),getUserCached:t=>(async(t,e)=>{try{return P[e]||(P[e]=await v(t,e)),P[e]}catch(t){throw t}})(z,t),getUser:t=>v(z,t),updateUser:(t,e)=>U(z,t,e),register:(t,e,a)=>j(z,t,e,a)},q={getById:(t,e)=>A(z,t,e),get:(t,e,a,r,s)=>I(z,t,e,a,r,s),put:(t,e,a)=>B(z,t,e,a),post:(t,e)=>C(z,t,e),delById:(t,e)=>L(z,t,e),del:(t,e)=>D(z,t,e)}}},e={};function a(r){if(e[r])return e[r].exports;var s=e[r]={exports:{}};return t[r](s,s.exports,a),s.exports}return a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a(368)})()}));